{% extends "base.html" %}
{% block title %}Export dataset (admin) • Smart Waste{% endblock %}
{% block content %}

<h1 class="text-2xl font-semibold mb-6">Export dataset (admin)</h1>

<form method="POST" class="bg-gray-900/60 border border-gray-800 rounded-xl p-6 space-y-6">
  <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">

  <div class="grid md:grid-cols-3 gap-4">
    <div>
      <label class="block text-sm mb-1">Intervallo: da</label>
      <input type="date" name="date_from"
             class="w-full bg-gray-800 border border-gray-700 rounded-lg px-3 py-2">
    </div>
    <div>
      <label class="block text-sm mb-1">Intervallo: a</label>
      <input type="date" name="date_to"
             class="w-full bg-gray-800 border border-gray-700 rounded-lg px-3 py-2">
    </div>
    <div>
      <label class="block text-sm mb-1">Confidenza minima</label>
      <input type="number" step="0.01" min="0" max="1" name="min_conf" value="0"
             class="w-full bg-gray-800 border border-gray-700 rounded-lg px-3 py-2">
      <p class="text-xs text-gray-500 mt-1">Usa valori 0–1 (es. 0.8 = 80%).</p>
    </div>
  </div>

  <div class="grid md:grid-cols-3 gap-4">
    <div>
      <label class="block text-sm mb-1">Fiducia minima utente</label>
      <input type="number" step="0.05" min="0" max="1" name="min_trust" placeholder="0.6"
             class="w-full bg-gray-800 border border-gray-700 rounded-lg px-3 py-2">
      <p class="text-xs text-gray-500 mt-1">
        Scarta esempi provenienti da utenti con affidabilità sotto soglia (0–1). Lascia vuoto/0 per nessun filtro.
      </p>
    </div>

    <div class="md:col-span-2">
      <label class="block text-sm mb-1">Ambito</label>
      <div class="flex items-center gap-6">
        <label class="inline-flex items-center gap-2">
          <input type="radio" name="scope" value="all" checked>
          <span>Tutti gli utenti</span>
        </label>
        <label class="inline-flex items-center gap-2">
          <input type="radio" name="scope" value="mine">
          <span>Solo le mie predizioni</span>
        </label>
      </div>
    </div>
  </div>

  <div>
    <label class="block text-sm mb-1">Opzioni</label>
    <div class="space-y-2">
      <label class="inline-flex items-center gap-2">
        <input type="checkbox" name="only_consented" checked>
        <span>Solo immagini con consenso</span>
      </label>
      <label class="inline-flex items-center gap-2">
        <input type="checkbox" name="include_unverified">
        <span>Includi non verificate</span>
      </label>
      <label class="inline-flex items-center gap-2">
        <input type="checkbox" name="include_user_hash">
        <span>Aggiungi hash utente (pseudonimo)</span>
      </label>
    </div>
  </div>

  <div>
    <button class="px-4 py-2 rounded-lg bg-emerald-700 hover:bg-emerald-600">
      Genera .zip
    </button>
  </div>

  <div class="text-sm text-gray-400">
    <p class="mb-1">Il .zip contiene:</p>
    <ul class="list-disc ml-5 space-y-1">
      <li><code>dataset.csv</code> con meta-dati</li>
      <li>cartella <code>images/</code> con le immagini ordinate per classe</li>
    </ul>
    <p class="mt-3">
      Colonne CSV: <em>id, filename, label_final, label_source, weight (pesato con fiducia),
      model_confidence, feedback, correct_class_feedback, timestamp, user_trust</em>
      (+ <em>user_hash</em> se spuntato).
    </p>
  </div>
</form>

{% endblock %}
