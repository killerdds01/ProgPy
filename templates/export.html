{% extends "base.html" %}
{% block title %}Esporta Dataset • Smart Waste{% endblock %}
{% block content %}
<div class="max-w-2xl">
  <h1 class="text-2xl font-semibold mb-4">Esporta dataset per il retraining</h1>
  <p class="text-sm text-gray-400 mb-6">
    Il file ZIP conterrà <code>dataset.csv</code> e la cartella <code>images/</code> (sottocartelle per classe).
    Per impostazione predefinita <strong>non</strong> include identificativi degli utenti.
  </p>

  <form method="POST" action="{{ url_for('do_export') }}" class="space-y-4 bg-gray-900/60 border border-gray-800 rounded-xl p-5">
    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">

    <div class="grid sm:grid-cols-2 gap-4">
      <div>
        <label class="block text-sm mb-1">Da data</label>
        <input name="date_from" type="datetime-local" class="w-full bg-gray-800 border border-gray-700 rounded-lg px-3 py-2" />
      </div>
      <div>
        <label class="block text-sm mb-1">A data</label>
        <input name="date_to" type="datetime-local" class="w-full bg-gray-800 border border-gray-700 rounded-lg px-3 py-2" />
      </div>
    </div>

    <div class="grid sm:grid-cols-2 gap-4">
      <div>
        <label class="block text-sm mb-1">Soglia confidenza minima</label>
        <input name="min_conf" type="number" step="0.01" min="0" max="1" value="0" class="w-full bg-gray-800 border border-gray-700 rounded-lg px-3 py-2" />
        <p class="text-xs text-gray-400 mt-1">Filtra predizioni con confidenza &lt; soglia (0–1).</p>
      </div>
      <label class="flex items-center gap-2">
        <input name="include_unverified" type="checkbox" class="scale-125">
        <span class="text-sm">Includi immagini non verificate</span>
      </label>
    </div>

    <div class="grid sm:grid-cols-2 gap-4">
      <div>
        <label class="block text-sm mb-1">Ambito export</label>
        <select name="scope" class="w-full bg-gray-800 border border-gray-700 rounded-lg px-3 py-2">
          <option value="mine">Solo miei dati</option>
          <option value="all" selected>Tutti gli utenti (admin)</option>
        </select>
      </div>
      <label class="flex items-center gap-2">
        <input name="include_user_hash" type="checkbox" class="scale-125">
        <span class="text-sm">Aggiungi hash utente (anonimo)</span>
      </label>
    </div>

    <button class="px-4 py-2 rounded-lg bg-emerald-700 hover:bg-emerald-600">
      Genera ZIP
    </button>
    <a href="{{ url_for('dashboard') }}" class="ml-2 text-sm text-gray-400 hover:text-gray-200">Torna alla Dashboard</a>
  </form>

  <div class="text-xs text-gray-500 mt-6">
    Colonne CSV: id, filename, label_final, label_source, weight, model_confidence, feedback, correct_class_feedback, timestamp, (user_hash opzionale)
  </div>
</div>
{% endblock %}
