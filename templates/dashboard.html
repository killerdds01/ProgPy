{% extends "base.html" %}
{% block title %}Dashboard • Smart Waste{% endblock %}
{% block content %}
<h1 class="text-xl font-semibold mb-4">Le mie predizioni</h1>

{% if pending_exists %}
  <div class="mb-4 text-sm text-amber-200">
    ⚠️ Hai una predizione in attesa di conferma. Vai alla <a class="underline" href="{{ url_for('app') }}">pagina di classificazione</a>.
  </div>
{% endif %}

<div class="grid md:grid-cols-5 gap-3 mb-6">
  {% for c in class_names %}
    <div class="bg-gray-900/60 border border-gray-800 rounded-lg p-4">
      <div class="text-sm text-gray-400">{{ c }}</div>
      <div class="text-2xl font-semibold">{{ class_counts.get(c, 0) }}</div>
    </div>
  {% endfor %}
</div>

<div class="overflow-x-auto rounded-lg border border-gray-800">
  <table class="min-w-full text-sm">
    <thead class="bg-gray-900/60">
      <tr>
        <th class="px-3 py-2 text-left">Immagine</th>
        <th class="px-3 py-2 text-left">Classe</th>
        <th class="px-3 py-2 text-left">Conf.</th>
        <th class="px-3 py-2 text-left">Stato</th>
        <th class="px-3 py-2 text-left">Data</th>
      </tr>
    </thead>
    <tbody>
      {% for p in predictions %}
        <tr class="border-t border-gray-800">
          <td class="px-3 py-2">
            {% if p.image_filename %}
              <img src="{{ url_for('uploaded_file', filename=p.image_filename) }}" alt="" class="h-16 w-16 object-cover rounded">
            {% endif %}
          </td>
          <td class="px-3 py-2">
            <span class="px-2 py-1 rounded bg-gray-800 border border-gray-700">{{ p['class'] }}</span>
          </td>
          <td class="px-3 py-2">{{ p.get('confidence','') }}</td>
          <td class="px-3 py-2">
            {% if p.get('feedback') %}
              {% if p.get('feedback') == 'correct' %}
                <span class="text-emerald-300">✔️ corretta</span>
              {% else %}
                <span class="text-rose-300">✏️ corretta dall'utente</span>
              {% endif %}
              {% if p.get('validated') is not none %}
                {% if p.get('validated') %}
                  <span class="ml-2 text-emerald-400">(validata)</span>
                {% else %}
                  <span class="ml-2 text-rose-400">(non validata)</span>
                {% endif %}
              {% endif %}
            {% else %}
              <span class="text-amber-300">in attesa</span>
            {% endif %}
            {% if p.get('needs_review') and p.get('feedback') is none %}
              <span class="ml-2 px-2 py-0.5 rounded bg-amber-900/50 border border-amber-800 text-amber-200">serve revisione</span>
            {% endif %}
          </td>
          <td class="px-3 py-2">
            {{ p.get('timestamp').strftime('%d/%m/%Y %H:%M') if p.get('timestamp') else '' }}
          </td>
        </tr>
      {% endfor %}
    </tbody>
  </table>
</div>
{% endblock %}
